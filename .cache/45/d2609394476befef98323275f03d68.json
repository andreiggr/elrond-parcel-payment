{"id":"GjfP","dependencies":[{"name":"/Users/mac/code/work/bitmarket/elrond-parcel/node_modules/@ledgerhq/devices/lib/hid-framing.js.map","includedInParent":true,"mtime":1647170302156},{"name":"/Users/mac/code/work/bitmarket/elrond-parcel/package.json","includedInParent":true,"mtime":1647174146392},{"name":"/Users/mac/code/work/bitmarket/elrond-parcel/node_modules/@ledgerhq/devices/package.json","includedInParent":true,"mtime":1647170301993},{"name":"@ledgerhq/errors","loc":{"line":8,"column":22,"index":129},"parent":"/Users/mac/code/work/bitmarket/elrond-parcel/node_modules/@ledgerhq/devices/lib/hid-framing.js","resolved":"/Users/mac/code/work/bitmarket/elrond-parcel/node_modules/@ledgerhq/errors/dist/index.js"},{"name":"buffer","parent":"/Users/mac/code/work/bitmarket/elrond-parcel/node_modules/@ledgerhq/devices/lib/hid-framing.js","resolved":"/Users/mac/code/work/bitmarket/elrond-parcel/node_modules/buffer/index.js"}],"generated":{"js":"var Buffer = require(\"buffer\").Buffer;\nvar e=require(\"buffer\").Buffer;Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.default=void 0;var t=require(\"@ledgerhq/errors\");const n=5;function r(t){const n=e.alloc(2);return n.writeUInt16BE(t,0),n}const a={data:e.alloc(0),dataLength:0,sequence:0},l=(n,l)=>({makeBlocks(t){let a=e.concat([r(t.length),t]);const o=l-5,c=Math.ceil(a.length/o);a=e.concat([a,e.alloc(c*o-a.length+1).fill(0)]);const d=[];for(let r=0;r<c;r++){const t=e.alloc(5);t.writeUInt16BE(n,0),t.writeUInt8(5,2),t.writeUInt16BE(r,3);const l=a.slice(r*o,(r+1)*o);d.push(e.concat([t,l]))}return d},reduceResponse(r,l){let{data:o,dataLength:c,sequence:d}=r||a;if(l.readUInt16BE(0)!==n)throw new t.TransportError(\"Invalid channel\",\"InvalidChannel\");if(5!==l.readUInt8(2))throw new t.TransportError(\"Invalid tag\",\"InvalidTag\");if(l.readUInt16BE(3)!==d)throw new t.TransportError(\"Invalid sequence\",\"InvalidSequence\");r||(c=l.readUInt16BE(5)),d++;const s=l.slice(r?5:7);return(o=e.concat([o,s])).length>c&&(o=o.slice(0,c)),{data:o,dataLength:c,sequence:d}},getReducedResult(e){if(e&&e.dataLength===e.data.length)return e.data}});var o=l;exports.default=o;"},"sourceMaps":{"js":{"mappings":[{"source":"../src/hid-framing.js","name":null,"original":{"line":3,"column":0},"generated":{"line":2,"column":109}},{"source":"../src/hid-framing.js","name":null,"original":{"line":3,"column":0},"generated":{"line":2,"column":113}},{"source":"../src/hid-framing.js","name":null,"original":{"line":3,"column":0},"generated":{"line":2,"column":115}},{"source":"../src/hid-framing.js","name":null,"original":{"line":3,"column":0},"generated":{"line":2,"column":123}},{"source":"../src/hid-framing.js","name":null,"original":{"line":11,"column":0},"generated":{"line":2,"column":143}},{"source":"../src/hid-framing.js","name":"Tag","original":{"line":11,"column":6},"generated":{"line":2,"column":149}},{"source":"../src/hid-framing.js","name":null,"original":{"line":11,"column":12},"generated":{"line":2,"column":151}},{"source":"../src/hid-framing.js","name":null,"original":{"line":13,"column":0},"generated":{"line":2,"column":153}},{"source":"../src/hid-framing.js","name":"asUInt16BE","original":{"line":13,"column":9},"generated":{"line":2,"column":162}},{"source":"../src/hid-framing.js","name":"value","original":{"line":13,"column":20},"generated":{"line":2,"column":164}},{"source":"../src/hid-framing.js","name":"b","original":{"line":14,"column":8},"generated":{"line":2,"column":167}},{"source":"../src/hid-framing.js","name":"b","original":{"line":14,"column":8},"generated":{"line":2,"column":173}},{"source":"../src/hid-framing.js","name":"Buffer","original":{"line":14,"column":12},"generated":{"line":2,"column":175}},{"source":"../src/hid-framing.js","name":"alloc","original":{"line":14,"column":19},"generated":{"line":2,"column":177}},{"source":"../src/hid-framing.js","name":null,"original":{"line":14,"column":25},"generated":{"line":2,"column":183}},{"source":"../src/hid-framing.js","name":"b","original":{"line":16,"column":9},"generated":{"line":2,"column":186}},{"source":"../src/hid-framing.js","name":"b","original":{"line":15,"column":2},"generated":{"line":2,"column":193}},{"source":"../src/hid-framing.js","name":"writeUInt16BE","original":{"line":15,"column":4},"generated":{"line":2,"column":195}},{"source":"../src/hid-framing.js","name":"value","original":{"line":15,"column":18},"generated":{"line":2,"column":209}},{"source":"../src/hid-framing.js","name":null,"original":{"line":15,"column":25},"generated":{"line":2,"column":211}},{"source":"../src/hid-framing.js","name":"b","original":{"line":16,"column":9},"generated":{"line":2,"column":214}},{"source":"../src/hid-framing.js","name":null,"original":{"line":19,"column":0},"generated":{"line":2,"column":216}},{"source":"../src/hid-framing.js","name":"initialAcc","original":{"line":19,"column":6},"generated":{"line":2,"column":222}},{"source":"../src/hid-framing.js","name":null,"original":{"line":19,"column":19},"generated":{"line":2,"column":224}},{"source":"../src/hid-framing.js","name":"data","original":{"line":20,"column":2},"generated":{"line":2,"column":225}},{"source":"../src/hid-framing.js","name":"Buffer","original":{"line":20,"column":8},"generated":{"line":2,"column":230}},{"source":"../src/hid-framing.js","name":"alloc","original":{"line":20,"column":15},"generated":{"line":2,"column":232}},{"source":"../src/hid-framing.js","name":null,"original":{"line":20,"column":21},"generated":{"line":2,"column":238}},{"source":"../src/hid-framing.js","name":"dataLength","original":{"line":21,"column":2},"generated":{"line":2,"column":241}},{"source":"../src/hid-framing.js","name":null,"original":{"line":21,"column":14},"generated":{"line":2,"column":252}},{"source":"../src/hid-framing.js","name":"sequence","original":{"line":22,"column":2},"generated":{"line":2,"column":254}},{"source":"../src/hid-framing.js","name":null,"original":{"line":22,"column":12},"generated":{"line":2,"column":263}},{"source":"../src/hid-framing.js","name":"createHIDframing","original":{"line":28,"column":6},"generated":{"line":2,"column":266}},{"source":"../src/hid-framing.js","name":null,"original":{"line":28,"column":25},"generated":{"line":2,"column":268}},{"source":"../src/hid-framing.js","name":"channel","original":{"line":28,"column":26},"generated":{"line":2,"column":269}},{"source":"../src/hid-framing.js","name":"packetSize","original":{"line":28,"column":43},"generated":{"line":2,"column":271}},{"source":"../src/hid-framing.js","name":null,"original":{"line":29,"column":9},"generated":{"line":2,"column":276}},{"source":"../src/hid-framing.js","name":"makeBlocks","original":{"line":30,"column":4},"generated":{"line":2,"column":277}},{"source":"../src/hid-framing.js","name":"apdu","original":{"line":30,"column":15},"generated":{"line":2,"column":288}},{"source":"../src/hid-framing.js","name":"data","original":{"line":31,"column":10},"generated":{"line":2,"column":291}},{"source":"../src/hid-framing.js","name":"data","original":{"line":31,"column":10},"generated":{"line":2,"column":295}},{"source":"../src/hid-framing.js","name":"Buffer","original":{"line":31,"column":17},"generated":{"line":2,"column":297}},{"source":"../src/hid-framing.js","name":"concat","original":{"line":31,"column":24},"generated":{"line":2,"column":299}},{"source":"../src/hid-framing.js","name":null,"original":{"line":31,"column":31},"generated":{"line":2,"column":306}},{"source":"../src/hid-framing.js","name":"asUInt16BE","original":{"line":31,"column":32},"generated":{"line":2,"column":307}},{"source":"../src/hid-framing.js","name":"apdu","original":{"line":31,"column":43},"generated":{"line":2,"column":309}},{"source":"../src/hid-framing.js","name":"length","original":{"line":31,"column":48},"generated":{"line":2,"column":311}},{"source":"../src/hid-framing.js","name":"apdu","original":{"line":31,"column":57},"generated":{"line":2,"column":319}},{"source":"../src/hid-framing.js","name":"blockSize","original":{"line":32,"column":12},"generated":{"line":2,"column":323}},{"source":"../src/hid-framing.js","name":"blockSize","original":{"line":32,"column":12},"generated":{"line":2,"column":329}},{"source":"../src/hid-framing.js","name":"packetSize","original":{"line":32,"column":24},"generated":{"line":2,"column":331}},{"source":"../src/hid-framing.js","name":null,"original":{"line":32,"column":37},"generated":{"line":2,"column":333}},{"source":"../src/hid-framing.js","name":"nbBlocks","original":{"line":33,"column":12},"generated":{"line":2,"column":335}},{"source":"../src/hid-framing.js","name":"Math","original":{"line":33,"column":23},"generated":{"line":2,"column":337}},{"source":"../src/hid-framing.js","name":"ceil","original":{"line":33,"column":28},"generated":{"line":2,"column":342}},{"source":"../src/hid-framing.js","name":"data","original":{"line":33,"column":33},"generated":{"line":2,"column":347}},{"source":"../src/hid-framing.js","name":"length","original":{"line":33,"column":38},"generated":{"line":2,"column":349}},{"source":"../src/hid-framing.js","name":"blockSize","original":{"line":33,"column":47},"generated":{"line":2,"column":356}},{"source":"../src/hid-framing.js","name":"data","original":{"line":34,"column":6},"generated":{"line":2,"column":359}},{"source":"../src/hid-framing.js","name":"Buffer","original":{"line":34,"column":13},"generated":{"line":2,"column":361}},{"source":"../src/hid-framing.js","name":"concat","original":{"line":34,"column":20},"generated":{"line":2,"column":363}},{"source":"../src/hid-framing.js","name":null,"original":{"line":34,"column":27},"generated":{"line":2,"column":370}},{"source":"../src/hid-framing.js","name":"data","original":{"line":35,"column":8},"generated":{"line":2,"column":371}},{"source":"../src/hid-framing.js","name":"Buffer","original":{"line":36,"column":8},"generated":{"line":2,"column":373}},{"source":"../src/hid-framing.js","name":"alloc","original":{"line":36,"column":15},"generated":{"line":2,"column":375}},{"source":"../src/hid-framing.js","name":"nbBlocks","original":{"line":36,"column":21},"generated":{"line":2,"column":381}},{"source":"../src/hid-framing.js","name":"blockSize","original":{"line":36,"column":32},"generated":{"line":2,"column":383}},{"source":"../src/hid-framing.js","name":"data","original":{"line":36,"column":44},"generated":{"line":2,"column":385}},{"source":"../src/hid-framing.js","name":"length","original":{"line":36,"column":49},"generated":{"line":2,"column":387}},{"source":"../src/hid-framing.js","name":null,"original":{"line":36,"column":58},"generated":{"line":2,"column":394}},{"source":"../src/hid-framing.js","name":"fill","original":{"line":36,"column":61},"generated":{"line":2,"column":397}},{"source":"../src/hid-framing.js","name":null,"original":{"line":36,"column":66},"generated":{"line":2,"column":402}},{"source":"../src/hid-framing.js","name":"blocks","original":{"line":39,"column":12},"generated":{"line":2,"column":407}},{"source":"../src/hid-framing.js","name":"blocks","original":{"line":39,"column":12},"generated":{"line":2,"column":413}},{"source":"../src/hid-framing.js","name":null,"original":{"line":39,"column":21},"generated":{"line":2,"column":415}},{"source":"../src/hid-framing.js","name":null,"original":{"line":40,"column":11},"generated":{"line":2,"column":418}},{"source":"../src/hid-framing.js","name":null,"original":{"line":40,"column":11},"generated":{"line":2,"column":422}},{"source":"../src/hid-framing.js","name":"i","original":{"line":40,"column":15},"generated":{"line":2,"column":426}},{"source":"../src/hid-framing.js","name":null,"original":{"line":40,"column":19},"generated":{"line":2,"column":428}},{"source":"../src/hid-framing.js","name":"i","original":{"line":40,"column":22},"generated":{"line":2,"column":430}},{"source":"../src/hid-framing.js","name":"nbBlocks","original":{"line":40,"column":26},"generated":{"line":2,"column":432}},{"source":"../src/hid-framing.js","name":"i","original":{"line":40,"column":36},"generated":{"line":2,"column":434}},{"source":"../src/hid-framing.js","name":null,"original":{"line":40,"column":41},"generated":{"line":2,"column":438}},{"source":"../src/hid-framing.js","name":"head","original":{"line":41,"column":14},"generated":{"line":2,"column":439}},{"source":"../src/hid-framing.js","name":"head","original":{"line":41,"column":14},"generated":{"line":2,"column":445}},{"source":"../src/hid-framing.js","name":"Buffer","original":{"line":41,"column":21},"generated":{"line":2,"column":447}},{"source":"../src/hid-framing.js","name":"alloc","original":{"line":41,"column":28},"generated":{"line":2,"column":449}},{"source":"../src/hid-framing.js","name":null,"original":{"line":41,"column":34},"generated":{"line":2,"column":455}},{"source":"../src/hid-framing.js","name":"head","original":{"line":42,"column":8},"generated":{"line":2,"column":458}},{"source":"../src/hid-framing.js","name":"writeUInt16BE","original":{"line":42,"column":13},"generated":{"line":2,"column":460}},{"source":"../src/hid-framing.js","name":"channel","original":{"line":42,"column":27},"generated":{"line":2,"column":474}},{"source":"../src/hid-framing.js","name":null,"original":{"line":42,"column":36},"generated":{"line":2,"column":476}},{"source":"../src/hid-framing.js","name":"head","original":{"line":43,"column":8},"generated":{"line":2,"column":479}},{"source":"../src/hid-framing.js","name":"writeUInt8","original":{"line":43,"column":13},"generated":{"line":2,"column":481}},{"source":"../src/hid-framing.js","name":null,"original":{"line":11,"column":12},"generated":{"line":2,"column":492}},{"source":"../src/hid-framing.js","name":null,"original":{"line":43,"column":29},"generated":{"line":2,"column":494}},{"source":"../src/hid-framing.js","name":"head","original":{"line":44,"column":8},"generated":{"line":2,"column":497}},{"source":"../src/hid-framing.js","name":"writeUInt16BE","original":{"line":44,"column":13},"generated":{"line":2,"column":499}},{"source":"../src/hid-framing.js","name":"i","original":{"line":44,"column":27},"generated":{"line":2,"column":513}},{"source":"../src/hid-framing.js","name":null,"original":{"line":44,"column":30},"generated":{"line":2,"column":515}},{"source":"../src/hid-framing.js","name":"chunk","original":{"line":45,"column":14},"generated":{"line":2,"column":518}},{"source":"../src/hid-framing.js","name":"chunk","original":{"line":45,"column":14},"generated":{"line":2,"column":524}},{"source":"../src/hid-framing.js","name":"data","original":{"line":45,"column":22},"generated":{"line":2,"column":526}},{"source":"../src/hid-framing.js","name":"slice","original":{"line":45,"column":27},"generated":{"line":2,"column":528}},{"source":"../src/hid-framing.js","name":"i","original":{"line":45,"column":33},"generated":{"line":2,"column":534}},{"source":"../src/hid-framing.js","name":"blockSize","original":{"line":45,"column":37},"generated":{"line":2,"column":536}},{"source":"../src/hid-framing.js","name":"i","original":{"line":45,"column":49},"generated":{"line":2,"column":539}},{"source":"../src/hid-framing.js","name":null,"original":{"line":45,"column":53},"generated":{"line":2,"column":541}},{"source":"../src/hid-framing.js","name":"blockSize","original":{"line":45,"column":58},"generated":{"line":2,"column":544}},{"source":"../src/hid-framing.js","name":"blocks","original":{"line":46,"column":8},"generated":{"line":2,"column":547}},{"source":"../src/hid-framing.js","name":"push","original":{"line":46,"column":15},"generated":{"line":2,"column":549}},{"source":"../src/hid-framing.js","name":"Buffer","original":{"line":46,"column":20},"generated":{"line":2,"column":554}},{"source":"../src/hid-framing.js","name":"concat","original":{"line":46,"column":27},"generated":{"line":2,"column":556}},{"source":"../src/hid-framing.js","name":null,"original":{"line":46,"column":34},"generated":{"line":2,"column":563}},{"source":"../src/hid-framing.js","name":"head","original":{"line":46,"column":35},"generated":{"line":2,"column":564}},{"source":"../src/hid-framing.js","name":"chunk","original":{"line":46,"column":41},"generated":{"line":2,"column":566}},{"source":"../src/hid-framing.js","name":"blocks","original":{"line":48,"column":13},"generated":{"line":2,"column":571}},{"source":"../src/hid-framing.js","name":"blocks","original":{"line":48,"column":13},"generated":{"line":2,"column":578}},{"source":"../src/hid-framing.js","name":"reduceResponse","original":{"line":51,"column":4},"generated":{"line":2,"column":581}},{"source":"../src/hid-framing.js","name":"acc","original":{"line":51,"column":19},"generated":{"line":2,"column":596}},{"source":"../src/hid-framing.js","name":"chunk","original":{"line":51,"column":37},"generated":{"line":2,"column":598}},{"source":"../src/hid-framing.js","name":null,"original":{"line":52,"column":10},"generated":{"line":2,"column":601}},{"source":"../src/hid-framing.js","name":null,"original":{"line":52,"column":10},"generated":{"line":2,"column":605}},{"source":"../src/hid-framing.js","name":"data","original":{"line":52,"column":12},"generated":{"line":2,"column":610}},{"source":"../src/hid-framing.js","name":null,"original":{"line":52,"column":10},"generated":{"line":2,"column":612}},{"source":"../src/hid-framing.js","name":"dataLength","original":{"line":52,"column":18},"generated":{"line":2,"column":623}},{"source":"../src/hid-framing.js","name":null,"original":{"line":52,"column":10},"generated":{"line":2,"column":625}},{"source":"../src/hid-framing.js","name":"sequence","original":{"line":52,"column":30},"generated":{"line":2,"column":634}},{"source":"../src/hid-framing.js","name":"acc","original":{"line":52,"column":43},"generated":{"line":2,"column":637}},{"source":"../src/hid-framing.js","name":"initialAcc","original":{"line":52,"column":50},"generated":{"line":2,"column":640}},{"source":"../src/hid-framing.js","name":"chunk","original":{"line":54,"column":10},"generated":{"line":2,"column":642}},{"source":"../src/hid-framing.js","name":"chunk","original":{"line":54,"column":10},"generated":{"line":2,"column":645}},{"source":"../src/hid-framing.js","name":"readUInt16BE","original":{"line":54,"column":16},"generated":{"line":2,"column":647}},{"source":"../src/hid-framing.js","name":null,"original":{"line":54,"column":29},"generated":{"line":2,"column":660}},{"source":"../src/hid-framing.js","name":"channel","original":{"line":54,"column":36},"generated":{"line":2,"column":665}},{"source":"../src/hid-framing.js","name":null,"original":{"line":55,"column":14},"generated":{"line":2,"column":667}},{"source":"../src/hid-framing.js","name":null,"original":{"line":55,"column":14},"generated":{"line":2,"column":673}},{"source":"../src/hid-framing.js","name":"TransportError","original":{"line":55,"column":18},"generated":{"line":2,"column":677}},{"source":"../src/hid-framing.js","name":null,"original":{"line":55,"column":14},"generated":{"line":2,"column":679}},{"source":"../src/hid-framing.js","name":null,"original":{"line":55,"column":33},"generated":{"line":2,"column":694}},{"source":"../src/hid-framing.js","name":null,"original":{"line":55,"column":52},"generated":{"line":2,"column":712}},{"source":"../src/hid-framing.js","name":"chunk","original":{"line":57,"column":10},"generated":{"line":2,"column":730}},{"source":"../src/hid-framing.js","name":null,"original":{"line":11,"column":12},"generated":{"line":2,"column":733}},{"source":"../src/hid-framing.js","name":"chunk","original":{"line":57,"column":10},"generated":{"line":2,"column":737}},{"source":"../src/hid-framing.js","name":"readUInt8","original":{"line":57,"column":16},"generated":{"line":2,"column":739}},{"source":"../src/hid-framing.js","name":null,"original":{"line":57,"column":26},"generated":{"line":2,"column":749}},{"source":"../src/hid-framing.js","name":null,"original":{"line":58,"column":14},"generated":{"line":2,"column":752}},{"source":"../src/hid-framing.js","name":null,"original":{"line":58,"column":14},"generated":{"line":2,"column":758}},{"source":"../src/hid-framing.js","name":"TransportError","original":{"line":58,"column":18},"generated":{"line":2,"column":762}},{"source":"../src/hid-framing.js","name":null,"original":{"line":58,"column":14},"generated":{"line":2,"column":764}},{"source":"../src/hid-framing.js","name":null,"original":{"line":58,"column":33},"generated":{"line":2,"column":779}},{"source":"../src/hid-framing.js","name":null,"original":{"line":58,"column":48},"generated":{"line":2,"column":793}},{"source":"../src/hid-framing.js","name":"chunk","original":{"line":60,"column":10},"generated":{"line":2,"column":807}},{"source":"../src/hid-framing.js","name":"chunk","original":{"line":60,"column":10},"generated":{"line":2,"column":810}},{"source":"../src/hid-framing.js","name":"readUInt16BE","original":{"line":60,"column":16},"generated":{"line":2,"column":812}},{"source":"../src/hid-framing.js","name":null,"original":{"line":60,"column":29},"generated":{"line":2,"column":825}},{"source":"../src/hid-framing.js","name":"sequence","original":{"line":60,"column":36},"generated":{"line":2,"column":830}},{"source":"../src/hid-framing.js","name":null,"original":{"line":61,"column":14},"generated":{"line":2,"column":832}},{"source":"../src/hid-framing.js","name":null,"original":{"line":61,"column":14},"generated":{"line":2,"column":838}},{"source":"../src/hid-framing.js","name":"TransportError","original":{"line":61,"column":18},"generated":{"line":2,"column":842}},{"source":"../src/hid-framing.js","name":null,"original":{"line":61,"column":14},"generated":{"line":2,"column":844}},{"source":"../src/hid-framing.js","name":null,"original":{"line":61,"column":33},"generated":{"line":2,"column":859}},{"source":"../src/hid-framing.js","name":null,"original":{"line":61,"column":53},"generated":{"line":2,"column":878}},{"source":"../src/hid-framing.js","name":"acc","original":{"line":64,"column":11},"generated":{"line":2,"column":897}},{"source":"../src/hid-framing.js","name":"dataLength","original":{"line":65,"column":8},"generated":{"line":2,"column":901}},{"source":"../src/hid-framing.js","name":"chunk","original":{"line":65,"column":21},"generated":{"line":2,"column":903}},{"source":"../src/hid-framing.js","name":"readUInt16BE","original":{"line":65,"column":27},"generated":{"line":2,"column":905}},{"source":"../src/hid-framing.js","name":null,"original":{"line":65,"column":40},"generated":{"line":2,"column":918}},{"source":"../src/hid-framing.js","name":"sequence","original":{"line":67,"column":6},"generated":{"line":2,"column":922}},{"source":"../src/hid-framing.js","name":"chunkData","original":{"line":68,"column":12},"generated":{"line":2,"column":926}},{"source":"../src/hid-framing.js","name":"chunkData","original":{"line":68,"column":12},"generated":{"line":2,"column":932}},{"source":"../src/hid-framing.js","name":"chunk","original":{"line":68,"column":24},"generated":{"line":2,"column":934}},{"source":"../src/hid-framing.js","name":"slice","original":{"line":68,"column":30},"generated":{"line":2,"column":936}},{"source":"../src/hid-framing.js","name":"acc","original":{"line":68,"column":36},"generated":{"line":2,"column":942}},{"source":"../src/hid-framing.js","name":null,"original":{"line":68,"column":42},"generated":{"line":2,"column":944}},{"source":"../src/hid-framing.js","name":null,"original":{"line":68,"column":46},"generated":{"line":2,"column":946}},{"source":"../src/hid-framing.js","name":null,"original":{"line":74,"column":13},"generated":{"line":2,"column":949}},{"source":"../src/hid-framing.js","name":"data","original":{"line":69,"column":6},"generated":{"line":2,"column":956}},{"source":"../src/hid-framing.js","name":"Buffer","original":{"line":69,"column":13},"generated":{"line":2,"column":958}},{"source":"../src/hid-framing.js","name":"concat","original":{"line":69,"column":20},"generated":{"line":2,"column":960}},{"source":"../src/hid-framing.js","name":null,"original":{"line":69,"column":27},"generated":{"line":2,"column":967}},{"source":"../src/hid-framing.js","name":"data","original":{"line":69,"column":28},"generated":{"line":2,"column":968}},{"source":"../src/hid-framing.js","name":"chunkData","original":{"line":69,"column":34},"generated":{"line":2,"column":970}},{"source":"../src/hid-framing.js","name":"length","original":{"line":70,"column":15},"generated":{"line":2,"column":975}},{"source":"../src/hid-framing.js","name":"dataLength","original":{"line":70,"column":24},"generated":{"line":2,"column":982}},{"source":"../src/hid-framing.js","name":"data","original":{"line":71,"column":8},"generated":{"line":2,"column":986}},{"source":"../src/hid-framing.js","name":"data","original":{"line":71,"column":15},"generated":{"line":2,"column":988}},{"source":"../src/hid-framing.js","name":"slice","original":{"line":71,"column":20},"generated":{"line":2,"column":990}},{"source":"../src/hid-framing.js","name":null,"original":{"line":71,"column":26},"generated":{"line":2,"column":996}},{"source":"../src/hid-framing.js","name":"dataLength","original":{"line":71,"column":29},"generated":{"line":2,"column":998}},{"source":"../src/hid-framing.js","name":null,"original":{"line":74,"column":13},"generated":{"line":2,"column":1002}},{"source":"../src/hid-framing.js","name":"data","original":{"line":75,"column":8},"generated":{"line":2,"column":1003}},{"source":"../src/hid-framing.js","name":"data","original":{"line":75,"column":8},"generated":{"line":2,"column":1008}},{"source":"../src/hid-framing.js","name":"dataLength","original":{"line":76,"column":8},"generated":{"line":2,"column":1010}},{"source":"../src/hid-framing.js","name":"dataLength","original":{"line":76,"column":8},"generated":{"line":2,"column":1021}},{"source":"../src/hid-framing.js","name":"sequence","original":{"line":77,"column":8},"generated":{"line":2,"column":1023}},{"source":"../src/hid-framing.js","name":"sequence","original":{"line":77,"column":8},"generated":{"line":2,"column":1032}},{"source":"../src/hid-framing.js","name":"getReducedResult","original":{"line":81,"column":4},"generated":{"line":2,"column":1036}},{"source":"../src/hid-framing.js","name":"acc","original":{"line":81,"column":21},"generated":{"line":2,"column":1053}},{"source":"../src/hid-framing.js","name":"acc","original":{"line":82,"column":10},"generated":{"line":2,"column":1056}},{"source":"../src/hid-framing.js","name":"acc","original":{"line":82,"column":10},"generated":{"line":2,"column":1059}},{"source":"../src/hid-framing.js","name":"acc","original":{"line":82,"column":17},"generated":{"line":2,"column":1062}},{"source":"../src/hid-framing.js","name":"dataLength","original":{"line":82,"column":21},"generated":{"line":2,"column":1064}},{"source":"../src/hid-framing.js","name":"acc","original":{"line":82,"column":36},"generated":{"line":2,"column":1077}},{"source":"../src/hid-framing.js","name":"data","original":{"line":82,"column":40},"generated":{"line":2,"column":1079}},{"source":"../src/hid-framing.js","name":"length","original":{"line":82,"column":45},"generated":{"line":2,"column":1084}},{"source":"../src/hid-framing.js","name":"acc","original":{"line":83,"column":15},"generated":{"line":2,"column":1091}},{"source":"../src/hid-framing.js","name":"acc","original":{"line":83,"column":15},"generated":{"line":2,"column":1098}},{"source":"../src/hid-framing.js","name":"data","original":{"line":83,"column":19},"generated":{"line":2,"column":1100}},{"source":"../src/hid-framing.js","name":"createHIDframing","original":{"line":89,"column":15},"generated":{"line":2,"column":1108}},{"source":"../src/hid-framing.js","name":"createHIDframing","original":{"line":89,"column":15},"generated":{"line":2,"column":1112}},{"source":"../src/hid-framing.js","name":"createHIDframing","original":{"line":89,"column":15},"generated":{"line":2,"column":1114}}],"sources":{"../src/hid-framing.js":"// @flow\n\nimport { TransportError } from \"@ledgerhq/errors\";\n\nexport type ResponseAcc = ?{\n  data: Buffer,\n  dataLength: number,\n  sequence: number,\n};\n\nconst Tag = 0x05;\n\nfunction asUInt16BE(value) {\n  const b = Buffer.alloc(2);\n  b.writeUInt16BE(value, 0);\n  return b;\n}\n\nconst initialAcc = {\n  data: Buffer.alloc(0),\n  dataLength: 0,\n  sequence: 0,\n};\n\n/**\n *\n */\nconst createHIDframing = (channel: number, packetSize: number) => {\n  return {\n    makeBlocks(apdu: Buffer): Buffer[] {\n      let data = Buffer.concat([asUInt16BE(apdu.length), apdu]);\n      const blockSize = packetSize - 5;\n      const nbBlocks = Math.ceil(data.length / blockSize);\n      data = Buffer.concat([\n        data, // fill data with padding\n        Buffer.alloc(nbBlocks * blockSize - data.length + 1).fill(0),\n      ]);\n\n      const blocks = [];\n      for (let i = 0; i < nbBlocks; i++) {\n        const head = Buffer.alloc(5);\n        head.writeUInt16BE(channel, 0);\n        head.writeUInt8(Tag, 2);\n        head.writeUInt16BE(i, 3);\n        const chunk = data.slice(i * blockSize, (i + 1) * blockSize);\n        blocks.push(Buffer.concat([head, chunk]));\n      }\n      return blocks;\n    },\n\n    reduceResponse(acc: ResponseAcc, chunk: Buffer): ResponseAcc {\n      let { data, dataLength, sequence } = acc || initialAcc;\n\n      if (chunk.readUInt16BE(0) !== channel) {\n        throw new TransportError(\"Invalid channel\", \"InvalidChannel\");\n      }\n      if (chunk.readUInt8(2) !== Tag) {\n        throw new TransportError(\"Invalid tag\", \"InvalidTag\");\n      }\n      if (chunk.readUInt16BE(3) !== sequence) {\n        throw new TransportError(\"Invalid sequence\", \"InvalidSequence\");\n      }\n\n      if (!acc) {\n        dataLength = chunk.readUInt16BE(5);\n      }\n      sequence++;\n      const chunkData = chunk.slice(acc ? 5 : 7);\n      data = Buffer.concat([data, chunkData]);\n      if (data.length > dataLength) {\n        data = data.slice(0, dataLength);\n      }\n\n      return {\n        data,\n        dataLength,\n        sequence,\n      };\n    },\n\n    getReducedResult(acc: ResponseAcc): ?Buffer {\n      if (acc && acc.dataLength === acc.data.length) {\n        return acc.data;\n      }\n    },\n  };\n};\n\nexport default createHIDframing;\n"},"lineCount":null}},"error":null,"hash":"2097be683da64dfba4b82d72e6f06f93","cacheData":{"env":{}}}