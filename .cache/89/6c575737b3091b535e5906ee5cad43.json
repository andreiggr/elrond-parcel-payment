{"id":"node_modules/@elrondnetwork/erdjs/out/transactionWatcher.js","dependencies":[{"name":"/Users/mac/code/work/bitmarket/elrond-parcel/node_modules/@elrondnetwork/erdjs/out/transactionWatcher.js.map","includedInParent":true,"mtime":1647170305381},{"name":"/Users/mac/code/work/bitmarket/elrond-parcel/package.json","includedInParent":true,"mtime":1647174146392},{"name":"/Users/mac/code/work/bitmarket/elrond-parcel/node_modules/@elrondnetwork/erdjs/package.json","includedInParent":true,"mtime":1647170304850},{"name":"./asyncTimer","loc":{"line":32,"column":29,"index":1683},"parent":"/Users/mac/code/work/bitmarket/elrond-parcel/node_modules/@elrondnetwork/erdjs/out/transactionWatcher.js","resolved":"/Users/mac/code/work/bitmarket/elrond-parcel/node_modules/@elrondnetwork/erdjs/out/asyncTimer.js"},{"name":"./errors","loc":{"line":33,"column":36,"index":1736},"parent":"/Users/mac/code/work/bitmarket/elrond-parcel/node_modules/@elrondnetwork/erdjs/out/transactionWatcher.js","resolved":"/Users/mac/code/work/bitmarket/elrond-parcel/node_modules/@elrondnetwork/erdjs/out/errors.js"},{"name":"./logger","loc":{"line":34,"column":25,"index":1775},"parent":"/Users/mac/code/work/bitmarket/elrond-parcel/node_modules/@elrondnetwork/erdjs/out/transactionWatcher.js","resolved":"/Users/mac/code/work/bitmarket/elrond-parcel/node_modules/@elrondnetwork/erdjs/out/logger.js"}],"generated":{"js":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TransactionWatcher = void 0;\nconst asyncTimer_1 = require(\"./asyncTimer\");\nconst errors = __importStar(require(\"./errors\"));\nconst logger_1 = require(\"./logger\");\n/**\n * TransactionWatcher allows one to continuously watch (monitor), by means of polling, the status of a given transaction.\n */\nclass TransactionWatcher {\n    /**\n     *\n     * @param hash The hash of the transaction to watch\n     * @param provider The provider to query the status from\n     * @param pollingInterval The polling interval, in milliseconds\n     * @param timeout The timeout, in milliseconds\n     */\n    constructor(hash, provider, pollingInterval = TransactionWatcher.DefaultPollingInterval, timeout = TransactionWatcher.DefaultTimeout) {\n        this.hash = hash;\n        this.provider = provider;\n        this.pollingInterval = pollingInterval;\n        this.timeout = timeout;\n    }\n    /**\n     * Waits until the transaction reaches the \"pending\" status.\n     */\n    awaitPending(onStatusReceived) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this.awaitStatus(status => status.isPending(), onStatusReceived || TransactionWatcher.NoopOnStatusReceived);\n        });\n    }\n    /**\n      * Waits until the transaction reaches the \"executed\" status.\n      */\n    awaitExecuted(onStatusReceived) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this.awaitStatus(status => status.isExecuted(), onStatusReceived || TransactionWatcher.NoopOnStatusReceived);\n        });\n    }\n    /**\n     * Waits until the predicate over the transaction status evaluates to \"true\".\n     * @param isAwaitedStatus A predicate over the status\n     */\n    awaitStatus(isAwaitedStatus, onStatusReceived) {\n        return __awaiter(this, void 0, void 0, function* () {\n            let doFetch = () => __awaiter(this, void 0, void 0, function* () { return yield this.provider.getTransactionStatus(this.hash); });\n            let errorProvider = () => new errors.ErrExpectedTransactionStatusNotReached();\n            return this.awaitConditionally(isAwaitedStatus, doFetch, onStatusReceived, errorProvider);\n        });\n    }\n    awaitNotarized() {\n        return __awaiter(this, void 0, void 0, function* () {\n            let isNotarized = (data) => !data.hyperblockHash.isEmpty();\n            let doFetch = () => __awaiter(this, void 0, void 0, function* () { return yield this.provider.getTransaction(this.hash); });\n            let errorProvider = () => new errors.ErrTransactionWatcherTimeout();\n            return this.awaitConditionally(isNotarized, doFetch, (_) => { }, errorProvider);\n        });\n    }\n    awaitConditionally(isSatisfied, doFetch, onFetched, createError) {\n        return __awaiter(this, void 0, void 0, function* () {\n            let periodicTimer = new asyncTimer_1.AsyncTimer(\"watcher:periodic\");\n            let timeoutTimer = new asyncTimer_1.AsyncTimer(\"watcher:timeout\");\n            let stop = false;\n            let fetchedData = undefined;\n            let _ = timeoutTimer.start(this.timeout).finally(() => {\n                timeoutTimer.stop();\n                stop = true;\n            });\n            while (!stop) {\n                try {\n                    fetchedData = yield doFetch();\n                    if (onFetched) {\n                        onFetched(fetchedData);\n                    }\n                    if (isSatisfied(fetchedData) || stop) {\n                        break;\n                    }\n                }\n                catch (error) {\n                    if (!(error instanceof errors.Err)) {\n                        throw error;\n                    }\n                    logger_1.Logger.info(\"cannot (yet) fetch data\");\n                }\n                yield periodicTimer.start(this.pollingInterval);\n            }\n            if (!timeoutTimer.isStopped()) {\n                timeoutTimer.stop();\n            }\n            let notSatisfied = !fetchedData || !isSatisfied(fetchedData);\n            if (notSatisfied) {\n                let error = createError();\n                throw error;\n            }\n        });\n    }\n}\nexports.TransactionWatcher = TransactionWatcher;\nTransactionWatcher.DefaultPollingInterval = 6000;\nTransactionWatcher.DefaultTimeout = TransactionWatcher.DefaultPollingInterval * 15;\nTransactionWatcher.NoopOnStatusReceived = (_) => { };\n"},"sourceMaps":{"js":{"version":3,"file":"transactionWatcher.js","sourceRoot":"","sources":["../src/transactionWatcher.ts"],"names":[],"mappings":"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","sourcesContent":[null]}},"error":null,"hash":"7c241c320b4dd9b0871ec36e62a4ccec","cacheData":{"env":{}}}